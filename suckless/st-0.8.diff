diff a/config.def.h b/config.def.h
8c8
< static char *font = "Liberation Mono:pixelsize=12:antialias=true:autohint=true";
---
> static char *font = "Liberation Mono:pixelsize=14:antialias=true:autohint=true";
180a181,186
> 	{ MODKEY,               XK_u,           kscrollup,      {.i = -1} },
> 	{ MODKEY,               XK_d,           kscrolldown,    {.i = -1} },
> 	{ MODKEY,               XK_y,           kscrollup,      {.i = +1} },
> 	{ MODKEY,               XK_e,           kscrolldown,    {.i = +1} },
> 	{ MODKEY|ShiftMask,     XK_K,           zoom,           {.f = +1} },
> 	{ MODKEY|ShiftMask,     XK_J,           zoom,           {.f = -1} },
Only in b: config.h
Only in b: st
diff a/st.c b/st.c
123a124,126
> 	Line hist[HISTSIZE]; /* history buffer */
> 	int histi;    /* history index */
> 	int scr;      /* scroll back */
191,192c194,195
< static void tscrollup(int, int);
< static void tscrolldown(int, int);
---
> static void tscrollup(int, int, int);
> static void tscrolldown(int, int, int);
434c437
< 	if (term.line[y][i - 1].mode & ATTR_WRAP)
---
> 	if (TLINE(y)[i - 1].mode & ATTR_WRAP)
437c440
< 	while (i > 0 && term.line[y][i - 1].u == ' ')
---
> 	while (i > 0 && TLINE(y)[i - 1].u == ' ')
546c549
< 		prevgp = &term.line[*y][*x];
---
> 		prevgp = &TLINE(*y)[*x];
561c564
< 				if (!(term.line[yt][xt].mode & ATTR_WRAP))
---
> 				if (!(TLINE(yt)[xt].mode & ATTR_WRAP))
568c571
< 			gp = &term.line[newy][newx];
---
> 			gp = &TLINE(newy)[newx];
589c592
< 				if (!(term.line[*y-1][term.col-1].mode
---
> 				if (!(TLINE(*y-1)[term.col-1].mode
596c599
< 				if (!(term.line[*y][term.col-1].mode
---
> 				if (!(TLINE(*y)[term.col-1].mode
627c630
< 			gp = &term.line[y][sel.nb.x];
---
> 			gp = &TLINE(y)[sel.nb.x];
630c633
< 			gp = &term.line[y][sel.nb.y == y ? sel.nb.x : 0];
---
> 			gp = &TLINE(y)[sel.nb.y == y ? sel.nb.x : 0];
633c636
< 		last = &term.line[y][MIN(lastx, linelen-1)];
---
> 		last = &TLINE(y)[MIN(lastx, linelen-1)];
837a841,843
> 	if (term.scr > 0 && term.scr < HISTSIZE-1)
> 		term.scr++;
> 
844a851,853
> 	Arg arg = (Arg) { .i = term.scr };
> 
> 	kscrolldown(&arg);
1056c1065,1099
< tscrolldown(int orig, int n)
---
> kscrolldown(const Arg* a)
> {
> 	int n = a->i;
> 
> 	if (n < 0)
> 		n = term.row + n;
> 
> 	if (n > term.scr)
> 		n = term.scr;
> 
> 	if (term.scr > 0) {
> 		term.scr -= n;
> 		selscroll(0, -n);
> 		tfulldirt();
> 	}
> }
> 
> void
> kscrollup(const Arg* a)
> {
> 	int n = a->i;
> 
> 	if (n < 0)
> 		n = term.row + n;
> 
> 	if (term.scr <= HISTSIZE-n) {
> 		term.scr += n;
> 		selscroll(0, n);
> 		tfulldirt();
> 	}
> }
> 
> 
> void
> tscrolldown(int orig, int n, int copyhist)
1062a1106,1112
> 	if (copyhist) {
> 		term.histi = (term.histi - 1 + HISTSIZE) % HISTSIZE;
> 		temp = term.hist[term.histi];
> 		term.hist[term.histi] = term.line[term.bot];
> 		term.line[term.bot] = temp;
> 	}
> 
1076c1126
< tscrollup(int orig, int n)
---
> tscrollup(int orig, int n, int copyhist)
1082a1133,1139
> 	if (copyhist) {
> 		term.histi = (term.histi + 1) % HISTSIZE;
> 		temp = term.hist[term.histi];
> 		term.hist[term.histi] = term.line[orig];
> 		term.line[orig] = temp;
> 	}
> 
1131c1188
< 		tscrollup(term.top, 1);
---
> 		tscrollup(term.top, 1, 1);
1296c1353
< 		tscrolldown(term.c.y, n);
---
> 		tscrolldown(term.c.y, n, 0);
1303c1360
< 		tscrollup(term.c.y, n);
---
> 		tscrollup(term.c.y, n, 0);
1732c1789
< 		tscrollup(term.top, csiescseq.arg[0]);
---
> 		tscrollup(term.top, csiescseq.arg[0], 0);
1736c1793
< 		tscrolldown(term.top, csiescseq.arg[0]);
---
> 		tscrolldown(term.top, csiescseq.arg[0], 0);
2260c2317
< 			tscrollup(term.top, 1);
---
> 			tscrollup(term.top, 1, 1);
2273c2330
< 			tscrolldown(term.top, 1);
---
> 			tscrolldown(term.top, 1, 1);
2492c2549
< 	int i;
---
> 	int i, j;
2529c2586,2594
< 	/* resize each row to new width, zero-pad if needed */
---
> 	for (i = 0; i < HISTSIZE; i++) {
> 		term.hist[i] = xrealloc(term.hist[i], col * sizeof(Glyph));
> 		for (j = mincol; j < col; j++) {
> 			term.hist[i][j] = term.c.attr;
> 			term.hist[i][j].u = ' ';
> 		}
> 	}
> 
> 	/* resize each r w to new width, zero-pad if needed */
2586c2651
< 		xdrawline(term.line[y], x1, y, x2);
---
> 		xdrawline(TLINE(y), x1, y, x2);
2607,2608c2672,2675
< 	xdrawcursor(cx, term.c.y, term.line[term.c.y][cx],
< 			term.ocx, term.ocy, term.line[term.ocy][term.ocx]);
---
> 	if (term.scr == 0) {
> 		xdrawcursor(cx, term.c.y, term.line[term.c.y][cx],
> 				term.ocx, term.ocy, term.line[term.ocy][term.ocx]);
> 	}
Only in b: st.c.orig
diff a/st.h b/st.h
5a6,8
> /* Arbitrary size */
> #define HISTSIZE      2000
> 
21a25,26
> #define TLINE(y)       ((y) < term.scr ? term.hist[((y) + term.histi - term.scr \
>                + HISTSIZE + 1) % HISTSIZE] : term.line[(y) - term.scr])
112a118,120
> 
> void kscrolldown(const Arg *);
> void kscrollup(const Arg *);
Only in b: st.o
Only in b: x.o
